name: Update Homepage with All Sections

on:
  schedule:
    - cron: '5 * * * *'  # ‡§π‡§∞ ‡§ò‡§Ç‡§ü‡•á 5 ‡§Æ‡§ø‡§®‡§ü ‡§™‡§∞ ‡§ö‡§≤‡•á‡§ó‡§æ
  workflow_dispatch:

jobs:
  update-homepage:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Update index.html with latest posts and static sections
        run: |
          # Confirm required files exist
          if [ ! -f "education.html" ] || [ ! -f "jobs.html" ] || [ ! -f "current-affairs.html" ]; then
            echo "One or more source files not found. Exiting."
            exit 1
          fi

          # Extract latest <article> from each auto-updated file
          LATEST_EDUCATION=$(grep -o '<article>.*</article>' education.html | head -n 1)
          LATEST_JOB=$(grep -o '<article>.*</article>' jobs.html | head -n 1)
          LATEST_CURRENT=$(grep -o '<article>.*</article>' current-affairs.html | head -n 1)

          # Prepare static sections
          RESULTS_SECTION="<section id='results' class='card'><h2>Results</h2><article><h4>‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</h4><p>‡§®‡§è ‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü‡•ç‡§∏ ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§è ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á‡•§</p><a href='results.html' class='read-more-btn'>‡§∏‡§≠‡•Ä ‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç...</a></article></section>"
          QUIZZES_SECTION="<section id='quizzes' class='card'><h2>Quizzes</h2><article><h4>‡§°‡•á‡§≤‡•Ä ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º</h4><p>‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã‡§Ç‡§ó‡•á‡•§</p><a href='quizzes.html' class='read-more-btn'>‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç...</a></article></section>"

          # Combine all sections into homepage content
          NEW_CONTENT="<main>"
          NEW_CONTENT+="<h2>‡§§‡§æ‡§ú‡§º‡§æ ‡§ñ‡§¨‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü‡•ç‡§∏</h2>"
          NEW_CONTENT+="<section id='education' class='card'><h2>Education News</h2>${LATEST_EDUCATION}<a href='education.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§è‡§ú‡•Å‡§ï‡•á‡§∂‡§® ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
          NEW_CONTENT+="<section id='jobs' class='card'><h2>Latest Jobs</h2>${LATEST_JOB}<a href='jobs.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§≤‡•á‡§ü‡•á‡§∏‡•ç‡§ü ‡§ú‡•â‡§¨‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
          NEW_CONTENT+="<section id='current-affairs' class='card'><h2>Current Affairs</h2>${LATEST_CURRENT}<a href='current-affairs.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§ï‡§∞‡•á‡§Ç‡§ü ‡§Ö‡§´‡•á‡§Ø‡§∞‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
          NEW_CONTENT+="${RESULTS_SECTION}"
          NEW_CONTENT+="${QUIZZES_SECTION}"
          NEW_CONTENT+="</main>"

          # Replace <main> block in index.html
          sed -i '/<main>/,/<\/main>/c\'"$NEW_CONTENT"'' index.html

      - name: Commit and push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          if ! git diff --quiet; then
            git add index.html
            git commit -m "ü§ñ Automated: Updated homepage with all 6 sections"
            git push
          else
            echo "Homepage is already up to date."