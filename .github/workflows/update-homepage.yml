name: Update Homepage with All Sections

on:
  schedule:
    - cron: '5 * * * *'  # ‡§π‡§∞ ‡§ò‡§Ç‡§ü‡•á 5 ‡§Æ‡§ø‡§®‡§ü ‡§™‡§∞ ‡§ö‡§≤‡•á‡§ó‡§æ
  workflow_dispatch:

jobs:
  update-homepage:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Fetch RSS feeds
      run: |
        curl -s https://www.jagranjosh.com/rss/education.xml -o education.xml
        curl -s https://www.jagranjosh.com/rss/jobs.xml -o jobs.xml
        curl -s https://www.hindustantimes.com/feeds/rss/india-news/rssfeed.xml -o current.xml

    - name: Extract headlines
      run: |
        EDU=$(grep -oP '(?<=<title>).*?(?=</title>)' education.xml | sed -n '2p')
        JOB=$(grep -oP '(?<=<title>).*?(?=</title>)' jobs.xml | sed -n '2p')
        CUR=$(grep -oP '(?<=<title>).*?(?=</title>)' current.xml | sed -n '2p')
        echo "EDU=$EDU" >> $GITHUB_ENV
        echo "JOB=$JOB" >> $GITHUB_ENV
        echo "CUR=$CUR" >> $GITHUB_ENV

    - name: Build homepage content
      run: |
        RESULTS_SECTION="<section id='results' class='card'><h2>üìä Results</h2><article><h4>‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</h4><p>‡§®‡§è ‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü‡•ç‡§∏ ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§è ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á‡•§</p><a href='results.html' class='read-more-btn'>‡§∏‡§≠‡•Ä ‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç...</a></article></section>"
        QUIZZES_SECTION="<section id='quizzes' class='card'><h2>üß† Quizzes</h2><article><h4>‡§°‡•á‡§≤‡•Ä ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º</h4><p>‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã‡§Ç‡§ó‡•á‡•§</p><a href='quizzes.html' class='read-more-btn'>‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç...</a></article></section>"

        NEW_CONTENT="<main>"
        NEW_CONTENT+="<h2>üîî ‡§§‡§æ‡§ú‡§º‡§æ ‡§ñ‡§¨‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü‡•ç‡§∏</h2>"
        NEW_CONTENT+="<section id='education' class='card'><h2>üéì Education News</h2><article><p>${EDU}</p></article><a href='education.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§è‡§ú‡•Å‡§ï‡•á‡§∂‡§® ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
        NEW_CONTENT+="<section id='jobs' class='card'><h2>üíº Latest Jobs</h2><article><p>${JOB}</p></article><a href='jobs.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§≤‡•á‡§ü‡•á‡§∏‡•ç‡§ü ‡§ú‡•â‡§¨‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
        NEW_CONTENT+="<section id='current-affairs' class='card'><h2>üì∞ Current Affairs</h2><article><p>${CUR}</p></article><a href='current-affairs.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§ï‡§∞‡•á‡§Ç‡§ü ‡§Ö‡§´‡•á‡§Ø‡§∞‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
        NEW_CONTENT+="${RESULTS_SECTION}"
        NEW_CONTENT+="${QUIZZES_SECTION}"
        NEW_CONTENT+="</main>"

        sed -i '/<main>/,/<\/main>/c\'"$NEW_CONTENT"'' index.html

    - name: Commit and push changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        if ! git diff --quiet; then
          git add index.html
          git commit -m "ü§ñ Homepage Updated: $EDU | $JOB | $CUR"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git push
        else
          echo "‚úÖ Homepage already up to date."