name: Update Homepage with All Sections

on:
  schedule:
    # ‡§π‡§∞ ‡§ò‡§Ç‡§ü‡•á 5 ‡§Æ‡§ø‡§®‡§ü ‡§™‡§∞ ‡§ö‡§≤‡§§‡§æ ‡§π‡•à
    - cron: '5 * * * *'
  workflow_dispatch:

jobs:
  update-homepage:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 

      - name: Update index.html with latest posts and static sections
        run: |
          # ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§∏‡§≠‡•Ä ‡§´‡§æ‡§á‡§≤‡•á‡§Ç ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à‡§Ç
          if [ ! -f "education.html" ] || [ ! -f "jobs.html" ] || [ ! -f "current-affairs.html" ]; then
            echo "One or more source files not found. Exiting."
            exit 1
          fi

          # ‡§π‡§∞ ‡§´‡§æ‡§á‡§≤ ‡§∏‡•á ‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡§æ <article> ‡§¨‡•ç‡§≤‡•â‡§ï ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
          LATEST_EDUCATION=$(grep -o '<article>.*</article>' education.html | head -n 1)
          LATEST_JOB=$(grep -o '<article>.*</article>' jobs.html | head -n 1)
          LATEST_CURRENT_AFFAIRS=$(grep -o '<article>.*</article>' current-affairs.html | head -n 1)

          # ‡§π‡•ã‡§Æ ‡§™‡•á‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§Ø‡§æ ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç
          # ‡§Ø‡§π ‡§ë‡§ü‡•ã‡§Æ‡•á‡§ü‡§ø‡§ï ‡§î‡§∞ ‡§∏‡•ç‡§ü‡•à‡§ü‡§ø‡§ï, ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§§‡§∞‡§π ‡§ï‡•á ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§¶‡§ø‡§ñ‡§æ‡§è‡§ó‡§æ
          NEW_CONTENT="<main>"
          NEW_CONTENT+="<h2>‡§§‡§æ‡§ú‡§º‡§æ ‡§ñ‡§¨‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü‡•ç‡§∏</h2>"
          
          # ‡§ë‡§ü‡•ã‡§Æ‡•á‡§ü‡§ø‡§ï ‡§∏‡•á‡§ï‡•ç‡§∂‡§®
          NEW_CONTENT+="<section id='education' class='card'><h2>Education News</h2>${LATEST_EDUCATION}<a href='education.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§è‡§ú‡•Å‡§ï‡•á‡§∂‡§® ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
          NEW_CONTENT+="<section id='jobs' class='card'><h2>Latest Jobs</h2>${LATEST_JOB}<a href='jobs.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§≤‡•á‡§ü‡•á‡§∏‡•ç‡§ü ‡§ú‡•â‡§¨‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
          NEW_CONTENT+="<section id='current-affairs' class='card'><h2>Current Affairs</h2>${LATEST_CURRENT_AFFAIRS}<a href='current-affairs.html' class='full-page-btn'>‡§∏‡§≠‡•Ä ‡§ï‡§∞‡•á‡§Ç‡§ü ‡§Ö‡§´‡•á‡§Ø‡§∞‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç</a></section>"
          
          # ‡§∏‡•ç‡§ü‡•à‡§ü‡§ø‡§ï (‡§Æ‡•à‡§®‡•Å‡§Ö‡§≤) ‡§∏‡•á‡§ï‡•ç‡§∂‡§®
          NEW_CONTENT+="<section id='results' class='card'><h2>Results</h2><article><h4>‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</h4><p>‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§Ø‡§π‡§æ‡§Å ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§</p><a href='results.html' class='read-more-btn'>‡§∏‡§≠‡•Ä ‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç...</a></article></section>"
          NEW_CONTENT+="<section id='quizzes' class='card'><h2>Quizzes</h2><article><h4>‡§°‡•á‡§≤‡•Ä ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º</h4><p>‡§Ö‡§™‡§®‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡•ã ‡§™‡§∞‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡•á‡§≤‡•Ä ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§≠‡§æ‡§ó ‡§≤‡•á‡§Ç‡•§</p><a href='quizzes.html' class='read-more-btn'>‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç...</a></article></section>"
          
          NEW_CONTENT+="</main>"

          # index.html ‡§´‡§æ‡§á‡§≤ ‡§ï‡§æ ‡§™‡•Å‡§∞‡§æ‡§®‡§æ <main> ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡§ü‡§æ‡§ï‡§∞ ‡§®‡§Ø‡§æ ‡§µ‡§æ‡§≤‡§æ ‡§°‡§æ‡§≤‡•á‡§Ç
          sed -i '/<main>/,/<\/main>/c\'"$NEW_CONTENT"'' index.html

      - name: Commit and push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          if ! git diff --quiet; then
            git add index.html
            git commit -m "ü§ñ Automated: Updated homepage with all sections"
            git push
          else
            echo "Homepage is already up to date."
          fi
