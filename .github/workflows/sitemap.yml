name: Refresh Sitemap

on:
  schedule:
    - cron: '15 * * * *'  # ‡§π‡§∞ ‡§ò‡§Ç‡§ü‡•á 15 ‡§Æ‡§ø‡§®‡§ü ‡§™‡§∞ ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§ö‡§≤‡•á‡§ó‡§æ
  workflow_dispatch:

jobs:
  update-sitemap:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Generate sitemap.xml if missing
      run: |
        if [ ! -f sitemap.xml ]; then
          echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>" > sitemap.xml
          echo "<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">" >> sitemap.xml
          echo "<url><loc>https://sandeepswami7426-oss.github.io/latest-education-hub/</loc><lastmod>2025-01-01T00:00:00+05:30</lastmod></url>" >> sitemap.xml
          echo "<url><loc>https://sandeepswami7426-oss.github.io/latest-education-hub/education.html</loc><lastmod>2025-01-01T00:00:00+05:30</lastmod></url>" >> sitemap.xml
          echo "<url><loc>https://sandeepswami7426-oss.github.io/latest-education-hub/jobs.html</loc><lastmod>2025-01-01T00:00:00+05:30</lastmod></url>" >> sitemap.xml
          echo "<url><loc>https://sandeepswami7426-oss.github.io/latest-education-hub/current-affairs.html</loc><lastmod>2025-01-01T00:00:00+05:30</lastmod></url>" >> sitemap.xml
          echo "<url><loc>https://sandeepswami7426-oss.github.io/latest-education-hub/results.html</loc><lastmod>2025-01-01T00:00:00+05:30</lastmod></url>" >> sitemap.xml
          echo "<url><loc>https://sandeepswami7426-oss.github.io/latest-education-hub/quizzes.html</loc><lastmod>2025-01-01T00:00:00+05:30</lastmod></url>" >> sitemap.xml
          echo "</urlset>" >> sitemap.xml
          echo "üÜï Sitemap.xml created with default structure"
        fi

    - name: Update <lastmod> timestamps
      run: |
        NOW=$(date +"%Y-%m-%dT%H:%M:%S+05:30")
        sed -i "s|<lastmod>.*</lastmod>|<lastmod>$NOW</lastmod>|g" sitemap.xml
        echo "üó∫Ô∏è Sitemap updated with lastmod: $NOW"

    - name: Commit and push changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'

        git add sitemap.xml
        if git diff --cached --quiet; then
          echo "‚úÖ Sitemap already up to date. No commit needed."
        else
          git commit -m "üó∫Ô∏è Sitemap refreshed: $NOW"
          git push origin main
          echo "üéâ Sitemap pushed successfully!"