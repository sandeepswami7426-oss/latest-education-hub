name: Refresh Sitemap Lastmod

on:
  schedule:
    - cron: '0 */6 * * *'  # ‡§π‡§∞ 6 ‡§ò‡§Ç‡§ü‡•á ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡•á‡§ó‡§æ
  workflow_dispatch:

jobs:
  update-sitemap:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Update <lastmod> tags in sitemap.xml
      run: |
        DATE=$(date +"%Y-%m-%dT%H:%M:%S%z")
        sed -i "s|<lastmod>.*</lastmod>|<lastmod>$DATE</lastmod>|g" sitemap.xml
        echo "üóÇÔ∏è Updated all <lastmod> tags to: $DATE"

    - name: Commit and push changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'

        git add sitemap.xml

        if git diff --cached --quiet; then
          echo "‚úÖ Sitemap already up to date. No commit needed."
        else
          COMMIT_MSG="üóìÔ∏è Sitemap Lastmod Updated: $DATE"
          echo "‚úÖ Committing with message: $COMMIT_MSG"
          git commit -m "$COMMIT_MSG"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git push
          echo "üéâ Push successful!"
        fi