name: Refresh Sitemap

on:
  schedule:
    - cron: '15 * * * *'  # рд╣рд░ рдШрдВрдЯреЗ 15 рдорд┐рдирдЯ рдкрд░ рдСрдЯреЛрдореИрдЯрд┐рдХ рдЪрд▓реЗрдЧрд╛
  workflow_dispatch:        # рдореИрдиреНрдпреБрдЕрд▓реА рднреА рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ

jobs:
  update-sitemap:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Update <lastmod> timestamps in sitemap.xml
      run: |
        # ЁЯХТ Generate current IST timestamp in sitemap format
        NOW=$(date +"%Y-%m-%dT%H:%M:%S+05:30")

        # ЁЯФз Replace all <lastmod> values with current timestamp
        sed -i "s|<lastmod>.*</lastmod>|<lastmod>$NOW</lastmod>|g" sitemap.xml

        echo "ЁЯЧ║я╕П Sitemap updated with lastmod: $NOW"

    - name: Commit and push sitemap changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'

        git add sitemap.xml
        if git diff --cached --quiet; then
          echo "тЬЕ Sitemap already up to date. No commit needed."
        else
          git commit -m "ЁЯЧ║я╕П Sitemap refreshed: $NOW"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git push
          echo "ЁЯОЙ Sitemap pushed successfully!"